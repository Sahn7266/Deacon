<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Beacon - Details</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Toast assets (single source of truth) -->
  <link rel="stylesheet" href="./assets/toast.css">
  <script src="./assets/toast.js" defer></script>

  <!-- REMOVE OR COMMENT OUT THIS LINE: -->
  <script src="./assets/notifications.js"></script>
  <link rel="stylesheet" href="./assets/loading.css">
  <script src="./assets/loading.js" defer></script>

  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif; }
    .table-fixed { table-layout: fixed; } td, th { white-space: nowrap; }

    /* Read-only inputs look like text */
    input[aria-readonly="true"] {
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
      background: transparent !important;
      caret-color: transparent;
    }
    input[aria-readonly="true"]:focus { border: none !important; outline: none !important; box-shadow: none !important; }
    input[aria-readonly="true"]::-moz-focus-inner { border: 0 !important; }
    
    /* Read-only select styling */
    select[aria-readonly="true"] {
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
      background: transparent !important;
      caret-color: transparent;
      appearance: none;
      pointer-events: none;
    }
    select[aria-readonly="true"]:focus { border: none !important; outline: none !important; box-shadow: none !important; }
    
    /* Inline edit input styling */
    .adgroup-details-input {
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      line-height: 1.25rem;
      background-color: white;
      color: #111827;
      width: 100%;
    }
    .adgroup-details-input:focus {
      outline: none;
      border-color: #93c5fd;
      box-shadow: 0 0 0 1px #93c5fd;
    }
    
    /* Select specific styling for edit mode */
    select.adgroup-details-input {
      appearance: auto;
      cursor: pointer;
    }
  </style>
</head>

<body class="bg-gray-100">
  <div class="flex h-screen flex-col">
    <!-- Header -->
    <header class="border-b border-gray-200 shadow-sm" style="background-color: #004E8B;">
      <div class="flex items-center justify-between px-4 py-2">
        <div class="flex items-center gap-3">
          <img src="./assets/BeaconLogo.png" alt="Beacon Logo" class="h-9 w-auto" />
        </div>

        <nav class="flex items-center gap-3 ml-auto">
            <a href="./index.html" class="text-base text-white hover:text-blue-100" style="font-size: 1.5rem; padding-right: 15px;" onmouseover="this.style.color='#48A9FE'" onmouseout="this.style.color='white'">
            Advertisers
            </a>
          <span class="text-white select-none">|</span>

          <!-- Notifications -->
          <div class="relative">
            <button id="notificationButton" class="p-2 rounded-md  text-white relative" title="Notifications" aria-label="View notifications" onmouseover="this.style.backgroundColor=''" onmouseout="this.style.backgroundColor=''" >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
              </svg>
              <span id="notificationDot" class="absolute top-2 right-2 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
            </button>

            <!-- Dropdown -->
            <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded-md shadow-lg z-50 max-h-96 overflow-hidden">
              <div class="p-3 border-b border-gray-200 bg-gray-50">
                <div class="flex items-center justify-between">
                  <h3 class="text-sm font-semibold text-gray-900">Notifications</h3>
                  <button id="markAllReadBtn" class="text-xs text-blue-600 hover:text-blue-800">Mark all read</button>
                </div>
              </div>

              <div class="max-h-80 overflow-y-auto">
                <div id="notificationList">
                  <!-- Sample items -->
                  <div class="p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer notification-item" data-read="false">
                    <div class="flex items-start gap-3">
                      <div class="flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900">Campaign Performance Alert</p>
                        <p class="text-xs text-gray-500 mt-1">"Summer Sale" exceeded budget by 15%</p>
                        <p class="text-xs text-gray-400 mt-1">2 minutes ago</p>
                      </div>
                    </div>
                  </div>

                  <div class="p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer notification-item" data-read="false">
                    <div class="flex items-start gap-3">
                      <div class="flex-shrink-0 w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900">New Advertiser Added</p>
                        <p class="text-xs text-gray-500 mt-1">Stallion Services LLC onboarded</p>
                        <p class="text-xs text-gray-400 mt-1">1 hour ago</p>
                      </div>
                    </div>
                  </div>

                  <div class="p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer notification-item" data-read="true">
                    <div class="flex items-start gap-3">
                      <div class="flex-shrink-0 w-2 h-2 bg-gray-300 rounded-full mt-2"></div>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm text-gray-700">Account Sync Complete</p>
                        <p class="text-xs text-gray-500 mt-1">CRM sync finished for 12 accounts</p>
                        <p class="text-xs text-gray-400 mt-1">3 hours ago</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="p-3 text-center border-t border-gray-200">
                  <a href="#" class="text-sm text-blue-600 hover:text-blue-800 font-medium">View all notifications</a>
                </div>
              </div>
            </div>
          </div>

          <!-- Waffle Menu -->
          <div class="relative">
            <button class="p-0 rounded-md text-white" id="menuButton" title="Menu" aria-label="Open navigation menu">
              <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                <path d="M4 4h3v3H4V4zM8.5 4h3v3h-3V4zM13 4h3v3h-3V4zM4 8.5h3v3H4v-3zM8.5 8.5h3v3h-3V8.5zM13 8.5h3v3h-3V8.5zM4 13h3v3H4v-3zM8.5 13h3v3h-3V13zM13 13h3v3h-3V13z"></path>
              </svg>
            </button>
            <div id="menuDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-md shadow-lg">
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Advertisers</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
              <a href="#" id="menuAdmin" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Admin</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign Out</a>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <!-- Body -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar -->
      <nav id="sidebar" class="bg-white w-64 p-4 border-r border-gray-200 overflow-y-auto transition-all duration-200 ease-in-out">
  <div class="flex items-center justify-between pb-4 border-b border-gray-200">
    <div class="flex items-center gap-3">
      <img src="./assets/advertiser.png" alt="Advertiser" class="w-9 h-9 rounded-full" data-sidebar-avatar />
      <h2 data-sidebar-header class="text-base text-lg font-semibold text-gray-800">Advertiser</h2>
    </div>
    <button id="sidebarToggle" class="p-1 rounded hover:bg-gray-100" aria-label="Toggle sidebar" aria-expanded="true" title="Collapse/Expand">
      <svg id="iconCollapse" class="w-5 h-5 text-gray-900" viewBox="0 0 26 26" fill="currentColor">
        <path fill="#000000" d="M21.5 11.5h-8.793l3.035-3.035a.5.5 0 10-.707-.707l-3.888 3.888a.518.518 0 00-.109.163.505.505 0 000 .382.518.518 0 00.109.163l3.888 3.888a.5.5 0 00.707-.707L12.707 12.5H21.5a.5.5 0 000-1zM7.5 2h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 7h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 11.5h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 16h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 21h-5a.5.5 0 000 1h5a.5.5 0 000-1z"></path>
      </svg>
      <svg id="iconExpand" class="w-5 h-5 text-gray-900 hidden" viewBox="0 0 26 26" fill="currentColor">
        <path fill="#000000" d="M21.962 12.191a.505.505 0 000-.382.518.518 0 00-.109-.163l-3.888-3.888a.5.5 0 10-.707.707l3.035 3.035H11.5a.5.5 0 000 1h8.793l-3.035 3.035a.5.5 0 10.707.707l3.888-3.888a.518.518 0 00.109-.163zM7.5 2h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 7h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 11.5h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 16h-5a.5.5 0 000 1h5a.5.5 0 000-1zM7.5 21h-5a.5.5 0 000 1h5a.5.5 0 000-1z"></path>
      </svg>
    </button>
  </div>

  <ul class="space-y-1 mt-4">
    <li>
      <a href="./WFAdvertiserDetails.html" data-nav-link class="flex items-center px-1 py-2 text-sm font-medium text-blue-700 bg-blue-50 rounded-md">
        <img src="./assets/svgs/Details.svg" alt="Details" class="w-6 h-6 mr-2" />
        <span data-link-label>Details</span>
      </a>
    </li>
    <li>
      <a href="./AdvertiserSalesOrder.html" data-nav-link class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-blue-50 rounded-md">
        <img src="./assets/svgs/SalesOrderExpense.svg" alt="Sales Orders" class="w-6 h-6 mr-2" />
        <span data-link-label>Sales Orders</span>
      </a>
    </li>
    <li>
      <a href="./WFAdvertiserConnections.html" data-nav-link class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-blue-50 rounded-md">
        <img src="./assets/svgs/Blueprint.svg" alt="Connections" class="w-6 h-6 mr-2" />
        <span data-link-label>Connections (P2)</span>
      </a>
    </li>
    <li>
      <a href="./AdvertiserCampaigns.html" data-nav-link class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-blue-50 rounded-md">
        <img src="./assets/svgs/CampaignsSchedules.svg" alt="Campaigns" class="w-6 h-6 mr-2" />
        <span data-link-label>Campaigns</span>
      </a>
    </li>
    <li>
      <a href="./AdvertiserAdGroup.html" data-nav-link class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-blue-50 rounded-md">
        <img src="./assets/svgs/AdGroups.svg" class="w-6 h-6 mr-2" alt="">
        <span data-link-label>Ad Groups</span>
      </a>
    </li>
    <!-- CAD (added) -->
    <li>
      <a href="./CAD.html" data-nav-link class="flex items-center px-1 py-2 text-sm text-gray-700 hover:bg-blue-50 rounded-md">
        <img src="./assets/svgs/Blueprint.svg" class="w-6 h-6 mr-2" alt="CAD">
        <span data-link-label>CAD</span>
      </a>
    </li>
  </ul>
</nav>

      <!-- Main -->
      <main class="flex-1 overflow-y-auto p-6">
        <div class="bg-white rounded-lg shadow-sm">
          <div class="p-4 border-b border-gray-200">
            <div class="flex items-start gap-4 mb-3">
              <div class="flex-1">
                <h1 data-bind="adv.name" class="md:text-2xl font-semibold text-gray-900">Loading…</h1>
                <div class="flex justify-between items-center">
                  <h3 class="text-sm font-semibold text-gray-600">Account #: <span data-bind="adv.account" class="text-sm text-gray-500">—</span></h3>
                  <h3 class="text-sm font-semibold text-gray-600">ID: <span data-bind="adv.id" class="text-sm text-gray-500">—</span></h3>
                </div>
              </div>
            </div>

            <hr class="border-gray-300 mp-4 p-2">

            <!-- Advertiser Details Section -->
            <section>
              <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-semibold text-gray-900 mx-2">ADVERTISER DETAILS</h1>
                <div class="flex items-center gap-2">
              <button id="editGeneralBtn" class="text-sm px-3 py-1 bg-white border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 flex items-center gap-2">
                <svg viewBox="0 0 24 24" height="16" width="16">
                  <path fill="#454B57" d="M21.53 4.11l-1.64-1.64a1.57 1.57 0 00-2.22 0L4.74 15.4a2.41 2.41 0 00-.55.83L2 21.58a.32.32 0 00.3.43h.11l5.35-2.18a2.41 2.41 0 00.83-.55l4.14-4.14 8.79-8.79a1.56 1.56 0 00.01-2.24zM5 17l2 2-3.43 1.4zm7-2.59l-4.11 4.14-2.44-2.44L16 5.53 18.47 8zm8.79-8.79l-1.62 1.65-2.44-2.44 1.65-1.66a.59.59 0 01.4-.16.58.58 0 01.4.16l1.65 1.65a.58.58 0 01.16.4.59.59 0 01-.16.4z"></path>
                </svg>
                Edit
              </button>
              <button id="saveGeneralBtn" class="hidden text-sm px-3 py-1 bg-blue-600 text-white border border-blue-600 rounded-md hover:bg-blue-700">Save</button>
              <button id="cancelGeneralBtn" class="hidden text-sm px-3 py-1 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">Cancel</button>
            </div>
              </div>
            </section>

            <!-- Two-column layout -->
            <div class="grid md:grid-cols-2 gap-6">
              
              <!-- LEFT COLUMN -->
              <div class="space-y-6">
                
                <!-- Beacon Fields -->
                <section class="space-y-2">
                  <div class="bg-white border border-blue-200 rounded-lg shadow-sm">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 px-4 py-3 border-b border-blue-200 rounded-t-lg">
                      <h4 class="font-semibold text-blue-900 text-sm uppercase tracking-wide">Beacon Fields</h4>
                    </div>
                    <div class="p-4">
                      <table class="w-full text-sm adgroup-details-table">
                        <tbody>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold" style="width: 40%;">ID:</td>
                            <td class="py-2">
                              <span id="displayAdvertiserId" data-bind="adv.id" class="text-gray-900">—</span>
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Account #:</td>
                            <td class="py-2">
                              <span id="accountDisplay" data-bind="adv.account" class="hidden text-gray-900">—</span>
                              <button id="accountLookupBtn" class="text-sm text-blue-600 hover:text-blue-800 underline">Select Account</button>
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Name:</td>
                            <td class="py-2">
                              <span id="displayAdvertiserName" data-bind="adv.name" class="text-gray-900">—</span>
                              <input id="inputAdvertiserName" type="text" data-bind="adv.name" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">State:</td>
                            <td class="py-2">
                              <span id="displayState" data-bind="adv.state" class="text-gray-900">—</span>
                              <select id="inputState" data-bind="adv.state" class="hidden adgroup-details-input w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-300">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                              </select>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>

                <!-- DSP Fields -->
                <section id="dspFieldsSection" class="space-y-2">
                  <div class="bg-white border border-blue-200 rounded-lg shadow-sm">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 px-4 py-3 border-b border-blue-200 rounded-t-lg">
                      <h4 class="font-semibold text-blue-900 text-sm uppercase tracking-wide">DSP Fields • The Trade Desk</h4>
                    </div>
                    <div class="p-4">
                      <table class="w-full text-sm adgroup-details-table">
                        <tbody>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold" style="width: 40%;">Name:</td>
                            <td class="py-2">
                              <span id="displayDspName" data-bind="adv.dsp.name" class="text-gray-900">—</span>
                              <input id="inputDspName" type="text" data-bind="adv.dsp.name" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Partner:</td>
                            <td class="py-2">
                              <span id="displayDspPartner" data-bind="adv.dsp.partner" class="text-gray-900">—</span>
                              <input id="inputDspPartner" type="text" data-bind="adv.dsp.partner" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Domain:</td>
                            <td class="py-2">
                              <span id="displayDspDomain" data-bind="adv.dsp.domain" class="text-gray-900">—</span>
                              <input id="inputDspDomain" type="text" data-bind="adv.dsp.domain" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Country:</td>
                            <td class="py-2">
                              <span id="displayDspCountry" data-bind="adv.dsp.country" class="text-gray-900">—</span>
                              <input id="inputDspCountry" type="text" data-bind="adv.dsp.country" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">EU Targeting:</td>
                            <td class="py-2">
                              <span id="displayDspEuTargeting" data-bind="adv.dsp.euTargeting" class="text-gray-900">—</span>
                              <input id="inputDspEuTargeting" type="text" data-bind="adv.dsp.euTargeting" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Industry:</td>
                            <td class="py-2">
                              <span id="displayDspIndustry" data-bind="adv.dsp.industry" class="text-gray-900">—</span>
                              <input id="inputDspIndustry" type="text" data-bind="adv.dsp.industry" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Attribution Click:</td>
                            <td class="py-2">
                              <span id="displayDspAttrClick" data-bind="adv.dsp.attributionWindows.click" class="text-gray-900">—</span>
                              <input id="inputDspAttrClick" type="text" data-bind="adv.dsp.attributionWindows.click" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Attribution Impression:</td>
                            <td class="py-2">
                              <span id="displayDspAttrImpression" data-bind="adv.dsp.attributionWindows.impression" class="text-gray-900">—</span>
                              <input id="inputDspAttrImpression" type="text" data-bind="adv.dsp.attributionWindows.impression" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Dedup Click:</td>
                            <td class="py-2">
                              <span id="displayDspDedupClick" data-bind="adv.dsp.deduplicationWindows.click" class="text-gray-900">—</span>
                              <input id="inputDspDedupClick" type="text" data-bind="adv.dsp.deduplicationWindows.click" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Dedup Conversion:</td>
                            <td class="py-2">
                              <span id="displayDspDedupConversion" data-bind="adv.dsp.deduplicationWindows.conversion" class="text-gray-900">—</span>
                              <input id="inputDspDedupConversion" type="text" data-bind="adv.dsp.deduplicationWindows.conversion" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Yahoo Integration:</td>
                            <td class="py-2">
                              <span id="displayDspYahoo" data-bind="adv.dsp.yahooIntegration" class="text-gray-900">—</span>
                              <input id="inputDspYahoo" type="text" data-bind="adv.dsp.yahooIntegration" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>

              </div>

              <!-- RIGHT COLUMN -->
              <div class="space-y-6">

                <!-- Team Table -->
                <section class="space-y-2">
                  <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
                    <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-4 py-3 border-b border-gray-200 rounded-t-lg flex items-center justify-between">
                      <h4 class="font-semibold text-gray-900 text-sm uppercase tracking-wide">Team</h4>
                      <div class="relative">
                        <button id="teamStateChip" class="flex items-center h-8 px-3 rounded-md text-sm text-gray-700 bg-white border border-gray-300 hover:bg-gray-100 transition" data-filter="state" aria-haspopup="menu" aria-expanded="false">
                          <span id="teamStateChipLabel">Active</span>
                          <svg class="w-4 h-4 text-gray-500 ml-2" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 011.06 0L10 10.92l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.23 8.27a.75.75 0 010-1.06z"/></svg>
                        </button>
                        <div id="teamStateMenu" class="hidden absolute right-0 mt-2 min-w-40 bg-white border border-gray-200 rounded-md shadow-lg z-20 max-h-56 overflow-auto" role="menu" tabindex="-1">
                          <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-value="All" role="menuitem">All</button>
                          <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-value="Active" role="menuitem">Active</button>
                          <button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-value="Inactive" role="menuitem">Inactive</button>
                        </div>
                      </div>
                    </div>
                    <div class="p-4">
                      <table class="w-full text-sm table-fixed">
                        <colgroup>
                          <col style="width:44%">
                          <col style="width:36%">
                          <col style="width:20%">
                        </colgroup>
                        <thead>
                          <tr class="border-b border-gray-300">
                            <th class="text-left py-2 text-gray-600 font-semibold">Name</th>
                            <th class="text-left py-2 text-gray-600 font-semibold">Role</th>
                            <th class="text-left py-2 text-gray-600 font-semibold">State</th>
                          </tr>
                        </thead>
                        <tbody id="teamTableBody">
                          <tr class="border-b border-gray-100" data-state="active">
                            <td class="py-2 text-gray-900">Matt Hunter</td>
                            <td class="py-2 text-gray-500">Account Manager</td>
                            <td class="py-2"><span class="px-2 py-1 text-xs">Active</span></td>
                          </tr>
                          <tr class="border-b border-gray-100" data-state="active">
                            <td class="py-2 text-gray-900">David DeHerrera</td>
                            <td class="py-2 text-gray-500">Campaign Specialist</td>
                            <td class="py-2"><span class="px-2 py-1 text-xs">Active</span></td>
                          </tr>
                          <tr class="border-b border-gray-100" data-state="inactive">
                            <td class="py-2 text-gray-900">Hailey Golden</td>
                            <td class="py-2 text-gray-500">Campaign Manager</td>
                            <td class="py-2"><span class="px-2 py-1 text-xs">Inactive</span></td>
                          </tr>
                          <tr class="border-b border-gray-100" data-state="active">
                            <td class="py-2 text-gray-900">Sam Ahn</td>
                            <td class="py-2 text-gray-500">Sales Representative</td>
                            <td class="py-2"><span class="px-2 py-1 text-xs">Active</span></td>
                          </tr>
                          <tr data-state="inactive">
                            <td class="py-2 text-gray-900">Trevor White</td>
                            <td class="py-2 text-gray-500">Partnership Sales</td>
                            <td class="py-2"><span class="px-2 py-1 text-xs">Inactive</span></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>

                <!-- Ad Server Fields -->
                <section id="adServerFieldsSection" class="space-y-2">
                  <div class="bg-white border border-green-200 rounded-lg shadow-sm">
                    <div class="bg-gradient-to-r from-green-50 to-green-100 px-4 py-3 border-b border-green-200 rounded-t-lg">
                      <h4 class="font-semibold text-green-900 text-sm uppercase tracking-wide">Ad Server Fields • Google Campaign Manager</h4>
                    </div>
                    <div class="p-4">
                      <table class="w-full text-sm adgroup-details-table">
                        <tbody>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold" style="width: 40%;">Advertiser Name:</td>
                            <td class="py-2">
                              <span id="displayAdServerName" data-bind="adv.adServer.advertiserName" class="text-gray-900">—</span>
                              <input id="inputAdServerName" type="text" data-bind="adv.adServer.advertiserName" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">Vertical:</td>
                            <td class="py-2">
                              <span id="displayAdServerVertical" data-bind="adv.adServer.vertical" class="text-gray-900">—</span>
                              <input id="inputAdServerVertical" type="text" data-bind="adv.adServer.vertical" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                          <tr>
                            <td class="py-2 pr-3 text-gray-600 font-semibold">EU Political Ads:</td>
                            <td class="py-2">
                              <span id="displayAdServerEuPolitical" data-bind="adv.adServer.declarations.euPoliticalAds" class="text-gray-900">—</span>
                              <input id="inputAdServerEuPolitical" type="text" data-bind="adv.adServer.declarations.euPoliticalAds" class="hidden adgroup-details-input">
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>

              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Waffle menu toggle -->
  <script>
    const menuButton = document.getElementById('menuButton');
    const menuDropdown = document.getElementById('menuDropdown');
    if (menuButton && menuDropdown) {
      menuButton.addEventListener('click', (e) => {
        e.stopPropagation();
        menuDropdown.classList.toggle('hidden');
      });
      document.addEventListener('click', (event) => {
        if (!menuButton.contains(event.target) && !menuDropdown.contains(event.target)) {
          menuDropdown.classList.add('hidden');
        }
      });
    }
  </script>

  <!-- Details page data-binding -->
  <script>
    (function() {
      const STORAGE_KEY_DATA = 'adv_list_data';

      function loadAdvertisersFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_DATA);
          return raw ? JSON.parse(raw) : [];
        } catch { return []; }
      }

      function getNestedValue(obj, path, fallback = '—') {
        if (!obj || !path) return fallback;
        const keys = path.split('.');
        let value = obj;
        for (const key of keys) {
          if (value && typeof value === 'object' && key in value) {
            value = value[key];
          } else {
            return fallback;
          }
        }
        return (value != null && String(value).trim() !== '') ? value : fallback;
      }

      function formatAttributionWindow(data) {
        if (!data || typeof data !== 'object') return '—';
        const value = data.value || '';
        const unit = data.unit || '';
        return value && unit ? `${value} ${unit}` : '—';
      }

      function bindAll(key, value, fallback = '—') {
        const nodes = document.querySelectorAll(`[data-bind="${key}"]`);
        let text = (value != null && String(value).trim() !== '') ? value : fallback;
        
        // Special formatting for attribution windows
        if (key.includes('attributionWindows')) {
          text = formatAttributionWindow(value);
        }
        
        nodes.forEach(el => {
          if (el.tagName === 'INPUT' || el.tagName === 'SELECT') {
            el.value = text;
            el.setAttribute('data-original', text);
          } else {
            el.textContent = text;
            if (key === 'adv.account') {
              const accountDisplay = document.getElementById('accountDisplay');
              const accountLookupBtn = document.getElementById('accountLookupBtn');
              if (accountDisplay && accountLookupBtn) {
                if (text && text !== '—' && text !== 'N/A') {
                  accountDisplay.classList.remove('hidden');
                  accountLookupBtn.classList.add('hidden');
                } else {
                  accountDisplay.classList.add('hidden');
                  accountLookupBtn.classList.remove('hidden');
                }
              }
            }
          }
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        let adv = null;
        try {
          const rawObj = localStorage.getItem('adv_selected_data');
          if (rawObj) adv = JSON.parse(rawObj);
        } catch {}

        const selectedId = localStorage.getItem('adv_selected_id');
        if (!adv && selectedId) {
          const advertisers = loadAdvertisersFromStorage();
          adv = advertisers.find(a => String(a.id) === String(selectedId)) || null;
        }
        if (!adv) {
          const advertisers = loadAdvertisersFromStorage();
          adv = (advertisers && advertisers.length) ? advertisers[0] : null;
        }

        if (adv) {
          // MIGRATION: Handle both 'status' and 'state' fields for backward compatibility
          if (adv.status && !adv.state) {
            adv.state = adv.status;
          }
          
          // Bind Beacon fields
          bindAll('adv.name', adv.name, 'No advertiser found');
          bindAll('adv.id', adv.id, '');
          bindAll('adv.account', adv.account, 'N/A');
          bindAll('adv.state', adv.state, 'N/A');
          
          // Bind DSP fields if they exist
          if (adv.dsp) {
            bindAll('adv.dsp.name', getNestedValue(adv, 'dsp.name'));
            bindAll('adv.dsp.partner', getNestedValue(adv, 'dsp.partner'));
            bindAll('adv.dsp.domain', getNestedValue(adv, 'dsp.domain'));
            bindAll('adv.dsp.country', getNestedValue(adv, 'dsp.country'));
            bindAll('adv.dsp.euTargeting', getNestedValue(adv, 'dsp.euTargeting'));
            bindAll('adv.dsp.industry', getNestedValue(adv, 'dsp.industry'));
            bindAll('adv.dsp.attributionWindows.click', getNestedValue(adv, 'dsp.attributionWindows.click'));
            bindAll('adv.dsp.attributionWindows.impression', getNestedValue(adv, 'dsp.attributionWindows.impression'));
            bindAll('adv.dsp.deduplicationWindows.click', getNestedValue(adv, 'dsp.deduplicationWindows.click') !== '—' ? getNestedValue(adv, 'dsp.deduplicationWindows.click') + ' Seconds' : '—');
            bindAll('adv.dsp.deduplicationWindows.conversion', getNestedValue(adv, 'dsp.deduplicationWindows.conversion') !== '—' ? getNestedValue(adv, 'dsp.deduplicationWindows.conversion') + ' Seconds' : '—');
            bindAll('adv.dsp.yahooIntegration', getNestedValue(adv, 'dsp.yahooIntegration'));
            
            // Show DSP section
            const dspSection = document.getElementById('dspFieldsSection');
            if (dspSection) dspSection.classList.remove('hidden');
          }
          
          // Bind Ad Server fields if they exist
          if (adv.adServer) {
            bindAll('adv.adServer.advertiserName', getNestedValue(adv, 'adServer.advertiserName'));
            bindAll('adv.adServer.vertical', getNestedValue(adv, 'adServer.vertical'));
            bindAll('adv.adServer.declarations.euPoliticalAds', getNestedValue(adv, 'adServer.declarations.euPoliticalAds'));
            
            // Show Ad Server section
            const adServerSection = document.getElementById('adServerFieldsSection');
            if (adServerSection) adServerSection.classList.remove('hidden');
          }
        } else {
          bindAll('adv.name', 'No advertiser found', 'No advertiser found');
          bindAll('adv.id', '', '');
          bindAll('adv.account', 'N/A', 'N/A');
          bindAll('adv.state', 'N/A', 'N/A');
        }

        // Expose for other modules if needed
        window.bindAll = bindAll;
        window.currentAdvertiser = adv;
      });
    })();
  </script>

  <!-- Team filter -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const chip = document.getElementById('teamStateChip');
      const menu = document.getElementById('teamStateMenu');
      const label = document.getElementById('teamStateChipLabel');
      const tbody = document.getElementById('teamTableBody');
      if (!chip || !menu || !label || !tbody) return;

      const closeMenu = () => { menu.classList.add('hidden'); chip.setAttribute('aria-expanded', 'false'); };

      chip.addEventListener('click', (e) => {
        e.stopPropagation();
        const open = menu.classList.toggle('hidden');
        chip.setAttribute('aria-expanded', String(!open));
        if (!open) { menu.setAttribute('tabindex','-1'); menu.focus(); }
      });

      document.addEventListener('click', closeMenu);

      menu.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') { closeMenu(); chip.focus(); }
      });

      menu.addEventListener('click', (e) => {
        const btn = e.target.closest('button'); if (!btn) return;
        const value = btn.dataset.value;
        label.textContent = value;

        tbody.querySelectorAll('tr').forEach(row => {
          const rowState = (row.getAttribute('data-state') || '').toLowerCase().trim();
          let show = true;
          if (value === 'Active') show = rowState === 'active';
          else if (value === 'Inactive') show = rowState === 'inactive';
          else show = true;
          row.style.display = show ? '' : 'none';
        });

        closeMenu();
      });

      // Default view = Active
      label.textContent = 'Active';
      tbody.querySelectorAll('tr').forEach(row => {
        const rowState = (row.getAttribute('data-state') || '').toLowerCase().trim();
        row.style.display = rowState === 'active' ? '' : 'none';
      });
    });
  </script>

  <!-- Account # display toggle -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const accountDisplay = document.getElementById('accountDisplay');
      const accountLookupBtn = document.getElementById('accountLookupBtn');
      if (!accountDisplay || !accountLookupBtn) return;

      function updateAccountDisplay() {
        const val = (accountDisplay.textContent || '').trim();
        const has = !!val && val !== '—' && val !== 'N/A';
        accountDisplay.classList.toggle('hidden', !has);
        accountLookupBtn.classList.toggle('hidden', has);
      }

      // initialize after bind
      setTimeout(updateAccountDisplay, 100);
      const obs = new MutationObserver(updateAccountDisplay);
      obs.observe(accountDisplay, { childList: true, subtree: true });
    });
  </script>



  <!-- General Edit/Save/Cancel behavior -->
  <script>
    (function () {
      const STORAGE_KEY_DATA = 'adv_list_data';
      const SELECTED_ID_KEY  = 'adv_selected_id';
      const SELECTED_DATA_KEY= 'adv_selected_data';

      // Pairs of span/input elements for inline editing
      const pairs = [
        { span: 'displayAdvertiserName', input: 'inputAdvertiserName' },
        { span: 'displayState', input: 'inputState' },
        // DSP Fields
        { span: 'displayDspName', input: 'inputDspName' },
        { span: 'displayDspPartner', input: 'inputDspPartner' },
        { span: 'displayDspDomain', input: 'inputDspDomain' },
        { span: 'displayDspCountry', input: 'inputDspCountry' },
        { span: 'displayDspEuTargeting', input: 'inputDspEuTargeting' },
        { span: 'displayDspIndustry', input: 'inputDspIndustry' },
        { span: 'displayDspAttrClick', input: 'inputDspAttrClick' },
        { span: 'displayDspAttrImpression', input: 'inputDspAttrImpression' },
        { span: 'displayDspDedupClick', input: 'inputDspDedupClick' },
        { span: 'displayDspDedupConversion', input: 'inputDspDedupConversion' },
        { span: 'displayDspYahoo', input: 'inputDspYahoo' },
        // Ad Server Fields
        { span: 'displayAdServerName', input: 'inputAdServerName' },
        { span: 'displayAdServerVertical', input: 'inputAdServerVertical' },
        { span: 'displayAdServerEuPolitical', input: 'inputAdServerEuPolitical' }
      ];

      const btnEdit   = document.getElementById('editGeneralBtn');
      const btnSave   = document.getElementById('saveGeneralBtn');
      const btnCancel = document.getElementById('cancelGeneralBtn');

      let editing = false;
      let snapshot = null;

      function showSpans() {
        pairs.forEach(p => {
          const span = document.getElementById(p.span);
          const input = document.getElementById(p.input);
          if (!span || !input) return;
          
          // Update span with input value
          let displayValue = input.value.trim();
          if (!displayValue || displayValue === '') {
            displayValue = '—';
          }
          
          span.textContent = displayValue;
          input.classList.add('hidden');
          span.classList.remove('hidden');
        });
      }

      function showInputs() {
        pairs.forEach(p => {
          const span = document.getElementById(p.span);
          const input = document.getElementById(p.input);
          if (!span || !input) return;
          
          input.classList.remove('hidden');
          span.classList.add('hidden');
          
          // Set input/select value from span
          let value = span.textContent.trim();
          if (value === '—' || value === 'N/A') {
            value = '';
          }
          
          // Special handling for State select
          if (input.id === 'inputState' && input.tagName === 'SELECT') {
            // Match the option value
            const options = Array.from(input.options);
            const match = options.find(opt => opt.value.toLowerCase() === value.toLowerCase());
            input.value = match ? match.value : (options.length > 0 ? options[0].value : '');
          } else {
            input.value = value;
          }
        });
      }

      function currentValues() {
        const obj = {};
        pairs.forEach(p => {
          const input = document.getElementById(p.input);
          if (input) obj[p.input] = input.value.trim();
        });
        return obj;
      }

      function shallowEqual(a,b){
        const ka = Object.keys(a), kb = Object.keys(b);
        if (ka.length !== kb.length) return false;
        for (const k of ka) if (a[k] !== b[k]) return false;
        return true;
      }

      btnEdit?.addEventListener('click', () => {
        editing = true;
        snapshot = currentValues();
        showInputs();
        
        btnEdit.classList.add('hidden');
        btnSave.classList.remove('hidden');
        btnCancel.classList.remove('hidden');
        
        // Auto-focus first editable field
        const firstInput = document.getElementById('inputAdvertiserName');
        if (firstInput) {
          setTimeout(() => firstInput.focus(), 50);
        }
      });

      btnCancel?.addEventListener('click', () => {
        if (!editing) return;
        
        // Revert to snapshot
        pairs.forEach(p => {
          const input = document.getElementById(p.input);
          if (input && snapshot && snapshot[p.input] != null) {
            input.value = snapshot[p.input];
          }
        });
        
        showSpans();
        editing = false;
        snapshot = null;
        
        btnEdit.classList.remove('hidden');
        btnSave.classList.add('hidden');
        btnCancel.classList.add('hidden');
      });

      btnSave?.addEventListener('click', () => {
        if (!editing) return;
        const now = currentValues();
        
        if (snapshot && shallowEqual(snapshot, now)) {
          // No changes
          showSpans();
          editing = false;
          snapshot = null;
          btnEdit.classList.remove('hidden');
          btnSave.classList.add('hidden');
          btnCancel.classList.add('hidden');
          return;
        }

        // Save changes
        const selectedId = localStorage.getItem(SELECTED_ID_KEY);
        if (!selectedId) {
          showToast({ message: 'No advertiser selected.', type: 'error' });
          return;
        }

        try {
          const advertisers = JSON.parse(localStorage.getItem(STORAGE_KEY_DATA) || '[]');
          const idx = advertisers.findIndex(a => String(a.id) === String(selectedId));
          if (idx === -1) {
            showToast({ message: 'Advertiser not found in storage.', type: 'error' });
            return;
          }

          // Update Beacon fields
          advertisers[idx].name = now.inputAdvertiserName?.trim() || '';
          advertisers[idx].state = now.inputState?.trim() || '';

          // Update DSP fields if they exist
          if (!advertisers[idx].dsp) advertisers[idx].dsp = {};
          advertisers[idx].dsp.name = now.inputDspName?.trim() || '';
          advertisers[idx].dsp.partner = now.inputDspPartner?.trim() || '';
          advertisers[idx].dsp.domain = now.inputDspDomain?.trim() || '';
          advertisers[idx].dsp.country = now.inputDspCountry?.trim() || '';
          advertisers[idx].dsp.euTargeting = now.inputDspEuTargeting?.trim() || '';
          advertisers[idx].dsp.industry = now.inputDspIndustry?.trim() || '';
          advertisers[idx].dsp.yahooIntegration = now.inputDspYahoo?.trim() || '';

          // Attribution windows (parse from "value unit" format back to object structure)
          if (!advertisers[idx].dsp.attributionWindows) advertisers[idx].dsp.attributionWindows = {};
          
          // Parse click attribution (e.g., "90 Days" -> {value: "90", unit: "Days"})
          const clickStr = now.inputDspAttrClick?.trim() || '';
          if (clickStr && clickStr !== '—') {
            const clickParts = clickStr.split(' ');
            advertisers[idx].dsp.attributionWindows.click = {
              value: clickParts[0] || '',
              unit: clickParts.slice(1).join(' ') || 'Days'
            };
          } else {
            advertisers[idx].dsp.attributionWindows.click = { value: '', unit: 'Days' };
          }
          
          // Parse impression attribution (e.g., "90 Days" -> {value: "90", unit: "Days"})
          const impressionStr = now.inputDspAttrImpression?.trim() || '';
          if (impressionStr && impressionStr !== '—') {
            const impressionParts = impressionStr.split(' ');
            advertisers[idx].dsp.attributionWindows.impression = {
              value: impressionParts[0] || '',
              unit: impressionParts.slice(1).join(' ') || 'Days'
            };
          } else {
            advertisers[idx].dsp.attributionWindows.impression = { value: '', unit: 'Days' };
          }

          // Deduplication windows (remove "Seconds" suffix if present)
          if (!advertisers[idx].dsp.deduplicationWindows) advertisers[idx].dsp.deduplicationWindows = {};
          advertisers[idx].dsp.deduplicationWindows.click = (now.inputDspDedupClick?.trim() || '').replace(' Seconds', '');
          advertisers[idx].dsp.deduplicationWindows.conversion = (now.inputDspDedupConversion?.trim() || '').replace(' Seconds', '');

          // Update Ad Server fields if they exist
          if (!advertisers[idx].adServer) advertisers[idx].adServer = {};
          advertisers[idx].adServer.advertiserName = now.inputAdServerName?.trim() || '';
          advertisers[idx].adServer.vertical = now.inputAdServerVertical?.trim() || '';
          
          if (!advertisers[idx].adServer.declarations) advertisers[idx].adServer.declarations = {};
          advertisers[idx].adServer.declarations.euPoliticalAds = now.inputAdServerEuPolitical?.trim() || '';

          localStorage.setItem(STORAGE_KEY_DATA, JSON.stringify(advertisers));
          localStorage.setItem(SELECTED_DATA_KEY, JSON.stringify(advertisers[idx]));

          showSpans();
          editing = false;
          snapshot = null;
          
          btnEdit.classList.remove('hidden');
          btnSave.classList.add('hidden');
          btnCancel.classList.add('hidden');
          
          showToast({ message: 'Data saved successfully.', type: 'success' });
        } catch (e) {
          console.error(e);
          showToast({ message: 'Save failed. Check console.', type: 'error' });
        }
      });

      // Simple toast function for compatibility
      function showToast(options) {
        const message = typeof options === 'string' ? options : options.message;
        const type = options.type || 'info';
        
        if (window.toast && typeof window.toast.success === 'function') {
          if (type === 'success') window.toast.success(message);
          else if (type === 'error') window.toast.error(message);
          else if (type === 'warning') window.toast.warning(message);
          else window.toast.info(message);
        } else {
          console.log('TOAST:', type.toUpperCase(), message);
        }
      }

      // Initialize to view mode (spans visible)
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => { showSpans(); }, 100);
      });
    })();
  </script>

  <!-- Account Lookup Modal -->
  <div id="accountLookupModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[80vh] overflow-auto">
      <div class="flex items-center justify-between p-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Account Lookup</h2>
        <button type="button" id="closeLookupX" class="text-gray-400 hover:text-gray-600 transition-colors" title="Close">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="p-4">
        <div class="mb-4">
          <input type="text" id="lookupSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Search by account number or name...">
        </div>
        
        <div class="max-h-96 overflow-y-auto">
          <table class="w-full text-sm">
            <thead class="bg-gray-50 sticky top-0">
              <tr>
                <th class="text-left py-2 px-4 font-medium text-gray-700">Account #</th>
                <th class="text-left py-2 px-4 font-medium text-gray-700">Account Name</th>
              </tr>
            </thead>
            <tbody id="lookupResults" class="divide-y divide-gray-200">
              <!-- Results populated by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="flex items-center justify-end space-x-3 p-4 border-t border-gray-200">
        <button type="button" id="cancelLookupBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">Cancel</button>
        <button type="button" id="selectAccountBtn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50" disabled>Select</button>
      </div>
    </div>
  </div>

  <!-- Account Lookup Logic -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Sample CRM accounts (same as other pages)
    const SAMPLE_CRM_ACCOUNTS = [
      { accountNumber: '12345', accountName: 'Acme Corporation' },
      { accountNumber: '67890', accountName: 'Global Tech Solutions' },
      { accountNumber: '11111', accountName: 'Sunrise Marketing' },
      { accountNumber: '22222', accountName: 'Metro Retail Group' },
      { accountNumber: '33333', accountName: 'Advanced Systems Inc' }
    ];

    const accountLookupBtn = document.getElementById('accountLookupBtn');
    const accountLookupModal = document.getElementById('accountLookupModal');
    const closeLookupX = document.getElementById('closeLookupX');
    const cancelLookupBtn = document.getElementById('cancelLookupBtn');
    const lookupSearch = document.getElementById('lookupSearch');
    const lookupResults = document.getElementById('lookupResults');
    const selectAccountBtn = document.getElementById('selectAccountBtn');

    if (!accountLookupBtn || !accountLookupModal) return;

    function closeLookupModal() {
      accountLookupModal.classList.add('hidden');
      document.body.style.overflow = 'auto';
      if (lookupSearch) lookupSearch.value = '';
      if (selectAccountBtn) selectAccountBtn.disabled = true;
    }

    function renderResults(accounts) {
      if (!lookupResults) return;
      lookupResults.innerHTML = '';
      
      accounts.forEach(account => {
        const tr = document.createElement('tr');
        tr.className = 'cursor-pointer hover:bg-gray-50';
        tr.dataset.accountNumber = account.accountNumber;
        tr.dataset.accountName = account.accountName;
        tr.innerHTML = `
          <td class="py-2 px-4">${account.accountNumber}</td>
          <td class="py-2 px-4">${account.accountName}</td>
        `;
        
        tr.addEventListener('click', function() {
          const prev = lookupResults.querySelector('tr.selected');
          if (prev) prev.classList.remove('bg-blue-50', 'selected');
          tr.classList.add('bg-blue-50', 'selected');
          if (selectAccountBtn) selectAccountBtn.disabled = false;
        });
        
        lookupResults.appendChild(tr);
      });
    }

    // Open modal
    accountLookupBtn.addEventListener('click', (e) => {
      e.preventDefault();
      accountLookupModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      renderResults(SAMPLE_CRM_ACCOUNTS);
      if (lookupSearch) lookupSearch.focus();
    });

    // Close modal handlers
    if (closeLookupX) closeLookupX.addEventListener('click', closeLookupModal);
    if (cancelLookupBtn) cancelLookupBtn.addEventListener('click', closeLookupModal);

    // Search functionality
    if (lookupSearch) {
      lookupSearch.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();
        const filtered = SAMPLE_CRM_ACCOUNTS.filter(account => 
          account.accountNumber.toLowerCase().includes(query) ||
          account.accountName.toLowerCase().includes(query)
        );
        renderResults(filtered);
      });
    }

    // Select account
    if (selectAccountBtn) {
      selectAccountBtn.addEventListener('click', function() {
        const selected = lookupResults ? lookupResults.querySelector('tr.selected') : null;
        if (!selected) return;

        const accountNumber = selected.dataset.accountNumber;
        const accountName = selected.dataset.accountName;

        // Update the display
        const accountDisplay = document.getElementById('accountDisplay');
        if (accountDisplay) {
          accountDisplay.textContent = accountNumber;
          accountDisplay.classList.remove('hidden');
        }
        
        if (accountLookupBtn) {
          accountLookupBtn.classList.add('hidden');
        }

        // Update the data in localStorage
        try {
          const selectedId = localStorage.getItem('adv_selected_id');
          if (selectedId) {
            const advertisers = JSON.parse(localStorage.getItem('adv_list_data') || '[]');
            const advIndex = advertisers.findIndex(a => String(a.id) === String(selectedId));
            
            if (advIndex !== -1) {
              advertisers[advIndex].account = accountNumber;
              localStorage.setItem('adv_list_data', JSON.stringify(advertisers));
              localStorage.setItem('adv_selected_data', JSON.stringify(advertisers[advIndex]));
              
              // Update data binding if available
              if (typeof window.bindAll === 'function') {
                window.bindAll('adv.account', accountNumber, 'N/A');
              }
            }
          }
        } catch (e) {
          console.error('Error updating account in storage:', e);
        }

        closeLookupModal();
        
        // Show success toast if available
        if (window.toast && typeof window.toast.success === 'function') {
          window.toast.success('Account updated successfully');
        }
      });
    }

    // Close on outside click
    accountLookupModal.addEventListener('click', function(e) {
      if (e.target === accountLookupModal) {
        closeLookupModal();
      }
    });

    // Close on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !accountLookupModal.classList.contains('hidden')) {
        closeLookupModal();
      }
    });
  });
  </script>
  <script src="./assets/sidebar.js" defer></script>
</body>
</html>